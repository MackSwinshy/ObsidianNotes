
- 14:44 
	#编程 #python 
	# Python Day 21 —— 文件读写和异常处理
	- 数据持久化：将数据从无法长久保存数据的存储介质（通常是内存）转移到可以长久保存数据的存储介质（通常是硬盘）中
	- **文件系统**：是一种存储和组织计算机数据的方法，使用**文件**和**树形目录**的抽象逻辑概念代替了硬盘、光盘、闪存等物理设备的数据块概念
		- 用户使用文件系统来保存数据时，不必关心数据实际保存在硬盘的哪个数据块上，只需要记住这个文件的路径和文件名
	## 打开和关闭文件
	- `open` 函数来打开文件（可以指定文件名、操作模式和字符编码等）
		- 操作模式（参数）列举：
			1. `'r'` 读取（默认）
			2. `'w'` 写入（会先截断之前的内容）
			3. `'x'` 写入（如果文件已存在会产生异常）
			4. `'a'` 追加（将内容写入已有文件的末尾）
			5. `'b'` 二进制模式
			6. `'t'` 文本模式（默认）
			7. `'+'` 更新（既可以读又可以写）
		  ![[Pasted image 20250518140220.png]]
		- 使用 `open` 函数打开文件成功后会返回一个**文件对象**
	## 读写文本文件
	- 可以用 `encoding` 参数来指定读写文件使用的字符编码（注意保证保存文件时使用的编码方式与 `encoding` 参数指定的编码方式是一致）
	- 使用文件对象的 `read` 方法读取文件：(注意文件和脚本得在同一目录下)
		```python
		file = open('致橡树.txt', 'r', encoding='utf-8')
		print(file.read())   # 文件对象的方法
		file.close()
		``` 
	
	- 使用 `for-in` 循环逐行读取或者用 `readlines` 方法将文件按行读取到一个列表容器中
		```python
		file = open('致橡树.txt', 'r', encoding='utf-8')
		for line in file:
	    	print(line, end='') # 文本文件每行末尾自带换行符\n，strip()可以去除原本的换行符
		file.close()
	
		file = open('致橡树.txt', 'r', encoding='utf-8')
		lines = file.readlines()
		for line in lines:
	    	print(line, end='')
		file.close()
		```
	
	- 向文件中写入内容
		```python
		file = open('致橡树.txt', 'a', encoding='utf-8')
		file.write('\n标题：《致橡树》')
		file.write('\n作者：舒婷')
		file.write('\n时间：1977年3月')
		file.close()
		``` 
	## 异常处理机制
	- 为了让代码具有健壮性和容错性，我们可以**使用Python的异常机制对可能在运行时发生状况的代码进行适当的处理**
		- 就是让代码在遇到异常时**不终止运行**（不崩溃），而是其他操作处理问题
		```python
		file = None
		try:
	    	file = open('致橡树.txt', 'r', encoding='utf-8')
	    	print(file.read())
		except FileNotFoundError:
	    	print('无法打开指定的文件!')
		except LookupError:
	    	print('指定了未知的编码!')
		except UnicodeDecodeError:
	    	print('读取文件时解码错误!')
		finally:
	    	if file:
	        	file.close()
		``` 
		- `try` 代码块：放置运行时会出现状况的代码
		- 在 `try` 后面可以跟上一个或多个 `except` 块来捕获异常并进行相应的处理
		- 在 `except` 后面，我们还可以加上 `else` 代码块，这是 `try` 中的代码没有出现异常时会执行的代码
		- 最后使用 `finally` 代码块（**总会执行**，无论程序正常或异常）来关闭打开的文件，释放掉程序中获取的外部资源
	- `raise` 用于在代码中**主动触发异常**（我理解一般不是“真正“”的代码异常，而是有悖于你编写逻辑的错误，比如数学问题中的定义域之外）
	```python
	class InputError(ValueError):
	    """自定义异常类型"""
	    pass
	
	def fac(num):
	    """求阶乘"""
	    if num < 0:   # 不符合阶乘逻辑，不可能小于0，但也不是代码运行时真正的异常
	        raise InputError('只能计算非负整数的阶乘')
	    if num in (0, 1):
	        return 1
	    return num * fac(num - 1)
	``` 
	## 上下文管理器语法
	- 可以使用 `with` 上下文管理器语法在文件操作完成后**自动执行文件对象的 `close` 方法**，不需要再写 `finally` 代码块来执行关闭文件释放资源的操作
		```python
		try:
	    	with open('致橡树.txt', 'r', encoding='utf-8') as file:
	        	print(file.read())
		except FileNotFoundError:
	    	print('无法打开指定的文件!')
		except LookupError:
	    	print('指定了未知的编码!')
		except UnicodeDecodeError:
	    	print('读取文件时解码错误!')	
		``` 
	## 读写二进制文件
	- 操作模式是 `'rb'` 或 `'wb'` （相比纯文本文件，后面多了 b）
	- `read` 方法的返回值以及 `write` 方法的参数是 `bytes-like` 对象（字节串）（文本文件是 `str` 对象，字符串）
		- 将当前路径下名为 `guido.jpg` 的图片文件复制到 `吉多.jpg` 文件中的操作
		```python
		try:
	    	with open('guido.jpg', 'rb') as file1:
	        	data = file1.read()
	    	with open('吉多.jpg', 'wb') as file2:
	        	file2.write(data)	
	    except FileNotFoundError:
	     	print('指定的文件无法打开.')
	 	except IOError:
	     	print('读写文件时出现错误.')
	 	print('程序执行结束.')
		``` 
		- 如果图片文件很大，为减少内存占用，可以传入 `size` 参数来指定每次读取的字节数，通过循环读取和写入的方式来完成上面的操作
		```python
		try:
	    	with open('guido.jpg', 'rb') as file1, open('吉多.jpg', 'wb') as file2:
	        	data = file1.read(512)
	        	while data:
	            	file2.write(data)   # 不会覆盖？
	            	data = file1.read()
		```
	 